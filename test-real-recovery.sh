#!/bin/bash

# –¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
# –°–æ–∑–¥–∞–µ—Ç —Ñ–∞–π–ª—ã –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –≤ —Ç–æ–º –∂–µ —Ñ–æ—Ä–º–∞—Ç–µ, —á—Ç–æ –∏ –æ—Å–Ω–æ–≤–Ω–æ–π –ø–∞—Ä—Å–µ—Ä

echo "üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞..."
echo "=============================================================="

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º—ã –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
if [ ! -f "server.js" ]; then
    echo "‚ùå –û—à–∏–±–∫–∞: –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∏–∑ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ wolmar-parser"
    exit 1
fi

echo "üìù –°–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª—ã –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø–∞—Ä—Å–µ—Ä–∞..."

# –°–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø–∞—Ä—Å–µ—Ä–∞ (—Ñ–æ—Ä–º–∞—Ç wolmar-parser5.js)
cat > parser_progress_2133.json << EOF
{
    "auctionUrl": "https://www.wolmar.ru/auction/2133",
    "currentIndex": 150,
    "totalLots": 200,
    "lastProcessedUrl": "https://www.wolmar.ru/auction/2133/lot/7512932",
    "timestamp": "$(date -u +%Y-%m-%dT%H:%M:%S.%3NZ)",
    "processed": 150,
    "errors": 5,
    "skipped": 10,
    "lotUrls": []
}
EOF

# –°–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –ø–∞—Ä—Å–µ—Ä–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞–≤–æ–∫
cat > mass_update_progress_968.json << EOF
{
    "auctionNumber": "968",
    "updateProgress": {
        "currentLot": 200,
        "progress": 80.0,
        "totalLots": 250
    },
    "lastUpdate": "$(date -u +%Y-%m-%dT%H:%M:%S.%3NZ)"
}
EOF

# –°–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Ä–æ–≥–Ω–æ–∑–æ–≤
cat > predictions_progress_2133.json << EOF
{
    "auctionNumber": "2133",
    "predictionsProgress": {
        "currentIndex": 100,
        "progress": 50.0,
        "totalLots": 200
    },
    "lastUpdate": "$(date -u +%Y-%m-%dT%H:%M:%S.%3NZ)"
}
EOF

echo "‚úÖ –§–∞–π–ª—ã –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ —Å–æ–∑–¥–∞–Ω—ã:"
echo "  ‚Ä¢ parser_progress_2133.json (–æ—Å–Ω–æ–≤–Ω–æ–π –ø–∞—Ä—Å–µ—Ä)"
echo "  ‚Ä¢ mass_update_progress_968.json (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞–≤–æ–∫)"
echo "  ‚Ä¢ predictions_progress_2133.json (–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–æ–≥–Ω–æ–∑–æ–≤)"

echo ""
echo "üîç –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∞–ª–∏–∑ —Å–±–æ—è..."
echo "============================"

# –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∞–ª–∏–∑
node analyze-crash-recovery.js

echo ""
echo "üìÑ –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ—Ç—á–µ—Ç –æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏..."
if [ -f "crash-recovery-report.json" ]; then
    echo "‚úÖ –û—Ç—á–µ—Ç —Å–æ–∑–¥–∞–Ω:"
    echo "üìä –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –æ—Ç—á–µ—Ç–∞:"
    cat crash-recovery-report.json | jq . 2>/dev/null || cat crash-recovery-report.json
else
    echo "‚ùå –û—Ç—á–µ—Ç –Ω–µ —Å–æ–∑–¥–∞–Ω"
fi

echo ""
echo "üöÄ –¢–µ—Å—Ç–∏—Ä—É–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ..."
echo "============================================="
echo "‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï: –≠—Ç–æ —Ç–æ–ª—å–∫–æ —Ç–µ—Å—Ç, –ø–∞—Ä—Å–µ—Ä—ã –ù–ï –±—É–¥—É—Ç –∑–∞–ø—É—â–µ–Ω—ã"
echo "–î–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ —Å—Ç—Ä–æ–∫—É –Ω–∏–∂–µ:"
echo "# node analyze-crash-recovery.js --auto-recovery"

# –û—á–∏—â–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã
echo ""
echo "üßπ –û—á–∏—â–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã..."
rm -f parser_progress_2133.json
rm -f mass_update_progress_968.json
rm -f predictions_progress_2133.json
rm -f crash-recovery-report.json

echo "‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ"
echo ""
echo "üìã –†–µ–∑—É–ª—å—Ç–∞—Ç—ã:"
echo "  ‚Ä¢ –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞: ‚úÖ"
echo "  ‚Ä¢ –ê–Ω–∞–ª–∏–∑ —Å–±–æ—è: ‚úÖ"
echo "  ‚Ä¢ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–∞: ‚úÖ"
echo "  ‚Ä¢ –û—á–∏—Å—Ç–∫–∞ —Ñ–∞–π–ª–æ–≤: ‚úÖ"
echo ""
echo "üéØ –ú–µ—Ö–∞–Ω–∏–∑–º –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏!"
