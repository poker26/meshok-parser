#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø—Ä–æ–±–ª–µ–º —Å —Å–µ—Ä–≤–µ—Ä–æ–º
# –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–∞–±–æ—Ç—É –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ –∏ –∫–∞—Ç–∞–ª–æ–≥–∞ –º–æ–Ω–µ—Ç

echo "üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º —Å —Å–µ—Ä–≤–µ—Ä–æ–º..."
echo "===================================="

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
if [ ! -f "/var/www/wolmar-parser/server.js" ]; then
    echo "‚ùå –û—à–∏–±–∫–∞: –°–∫—Ä–∏–ø—Ç –¥–æ–ª–∂–µ–Ω –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –≤ /var/www/wolmar-parser"
    exit 1
fi

cd /var/www/wolmar-parser

echo "üìä –≠–¢–ê–ü 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ PM2..."
pm2 status

echo ""
echo "üîç –≠–¢–ê–ü 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –Ω–∞ –ø–æ—Ä—Ç–∞—Ö..."
netstat -tlnp | grep -E ":(3000|3001)"

echo ""
echo "üåê –≠–¢–ê–ü 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ (–ø–æ—Ä—Ç 3001)..."
curl -s http://localhost:3001/api/health
if [ $? -eq 0 ]; then
    echo "‚úÖ –û—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–µ—Ä –æ—Ç–≤–µ—á–∞–µ—Ç"
else
    echo "‚ùå –û—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–µ—Ä –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç"
fi

echo ""
echo "üåê –≠–¢–ê–ü 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ API –∞—É–∫—Ü–∏–æ–Ω–æ–≤..."
curl -s http://localhost:3001/api/auctions
if [ $? -eq 0 ]; then
    echo "‚úÖ API –∞—É–∫—Ü–∏–æ–Ω–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç"
else
    echo "‚ùå API –∞—É–∫—Ü–∏–æ–Ω–æ–≤ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç"
fi

echo ""
echo "üåê –≠–¢–ê–ü 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—Ç–∞–ª–æ–≥–∞ –º–æ–Ω–µ—Ç (–ø–æ—Ä—Ç 3000)..."
curl -s http://localhost:3000/api/auctions
if [ $? -eq 0 ]; then
    echo "‚úÖ –ö–∞—Ç–∞–ª–æ–≥ –º–æ–Ω–µ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç"
else
    echo "‚ùå –ö–∞—Ç–∞–ª–æ–≥ –º–æ–Ω–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç"
fi

echo ""
echo "üìã –≠–¢–ê–ü 6: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞..."
pm2 logs wolmar-parser --lines 10

echo ""
echo "üìã –≠–¢–ê–ü 7: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –∫–∞—Ç–∞–ª–æ–≥–∞..."
pm2 logs catalog-interface --lines 10

echo ""
echo "üîç –≠–¢–ê–ü 8: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–æ–≤ —Å–µ—Ä–≤–µ—Ä–∞..."
ls -la /var/www/wolmar-parser/server.js
ls -la /var/www/catalog-interface/server.js

echo ""
echo "‚úÖ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"
