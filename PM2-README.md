# üöÄ PM2 –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–µ—Ä–≤–µ—Ä–∞

## üìã –û–ø–∏—Å–∞–Ω–∏–µ
PM2 (Process Manager 2) - —ç—Ç–æ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –¥–ª—è Node.js –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π, –∫–æ—Ç–æ—Ä—ã–π –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫** –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ —Å–µ—Ä–≤–µ—Ä–∞
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–µ—Å—É—Ä—Å–æ–≤** (CPU, –ø–∞–º—è—Ç—å, uptime)
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** —Å —Ä–æ—Ç–∞—Ü–∏–µ–π
- **Web-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å** –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- **Graceful shutdown** –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ

## üõ†Ô∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É
```bash
ssh root@46.173.19.68
cd /var/www/wolmar-parser
```

### 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ PM2
```bash
npm install -g pm2
```

### 3. –ó–∞–ø—É—Å–∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
```bash
chmod +x setup-pm2.sh
./setup-pm2.sh
```

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
```bash
pm2 status
pm2 logs wolmar-parser
```

## üìä –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–æ–º

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
```bash
# –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç
./manage-server.sh start      # –ó–∞–ø—É—Å–∫
./manage-server.sh stop       # –û—Å—Ç–∞–Ω–æ–≤–∫–∞
./manage-server.sh restart    # –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
./manage-server.sh status     # –°—Ç–∞—Ç—É—Å
./manage-server.sh logs       # –õ–æ–≥–∏
./manage-server.sh monit      # –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
./manage-server.sh health     # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è
./manage-server.sh update     # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å git
```

### –ü—Ä—è–º—ã–µ –∫–æ–º–∞–Ω–¥—ã PM2
```bash
pm2 start ecosystem.config.js    # –ó–∞–ø—É—Å–∫
pm2 stop wolmar-parser           # –û—Å—Ç–∞–Ω–æ–≤–∫–∞
pm2 restart wolmar-parser       # –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
pm2 reload wolmar-parser         # Graceful reload
pm2 delete wolmar-parser         # –£–¥–∞–ª–µ–Ω–∏–µ
pm2 save                         # –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
pm2 resurrect                    # –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å—ã
```

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –°—Ç–∞—Ç—É—Å –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
```bash
pm2 status
```

### –õ–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
```bash
pm2 logs wolmar-parser
pm2 logs wolmar-parser --lines 100
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–µ—Å—É—Ä—Å–æ–≤
```bash
pm2 monit
```

### Health check
```bash
curl http://localhost:3001/api/health
```

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –§–∞–π–ª ecosystem.config.js
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫** –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–µ—Å—É—Ä—Å–æ–≤** (CPU, –ø–∞–º—è—Ç—å)
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** —Å —Ä–æ—Ç–∞—Ü–∏–µ–π
- **Health check** –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
- **Graceful shutdown** –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ
- **–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é** (–∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 3:00)

### –õ–æ–≥–∏
- **–û–±—â–∏–µ –ª–æ–≥–∏**: `./logs/combined.log`
- **–í—ã–≤–æ–¥**: `./logs/out.log`
- **–û—à–∏–±–∫–∏**: `./logs/error.log`
- **–†–æ—Ç–∞—Ü–∏—è**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ 10MB
- **–ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ**: 30 –¥–Ω–µ–π

## üö® –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
```bash
pm2 install pm2-slack
pm2 set pm2-slack:webhook_url "YOUR_SLACK_WEBHOOK"
pm2 set pm2-slack:channel "#alerts"
```

### Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
```bash
pm2 install pm2-mail
pm2 set pm2-mail:to "admin@example.com"
pm2 set pm2-mail:from "noreply@example.com"
```

## üìä Web-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

### PM2 Plus (–ª–æ–∫–∞–ª—å–Ω–æ)
```bash
pm2 plus
# –û—Ç–∫—Ä—ã—Ç—å: http://localhost:9615
```

### –£–¥–∞–ª–µ–Ω–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
```bash
pm2 plus
# –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —É–¥–∞–ª–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø
```

## üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è

### –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ
```bash
pm2 startup
pm2 save
```

### Cron –∑–∞–¥–∞—á–∏
```bash
# –î–æ–±–∞–≤–∏—Ç—å –≤ crontab
0 3 * * * cd /var/www/wolmar-parser && pm2 restart wolmar-parser
```

## üõ†Ô∏è Troubleshooting

### –ü—Ä–æ–±–ª–µ–º—ã —Å –∑–∞–ø—É—Å–∫–æ–º
```bash
pm2 logs wolmar-parser --lines 100
pm2 describe wolmar-parser
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å –ø–∞–º—è—Ç—å—é
```bash
pm2 restart wolmar-parser
pm2 monit
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å –ø–æ—Ä—Ç–æ–º
```bash
netstat -tulpn | grep 3001
lsof -i :3001
```

## üìã –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
./manage-server.sh backup-logs
```

### –û—á–∏—Å—Ç–∫–∞ –ª–æ–≥–æ–≤
```bash
./manage-server.sh clean-logs
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞
```bash
./manage-server.sh update
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è
```bash
./manage-server.sh health
```

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ PM2 –≤—ã –ø–æ–ª—É—á–∏—Ç–µ:
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫** –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ —Å–µ—Ä–≤–µ—Ä–∞
- ‚úÖ **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–µ—Å—É—Ä—Å–æ–≤** –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- ‚úÖ **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** —Å —Ä–æ—Ç–∞—Ü–∏–µ–π –∏ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- ‚úÖ **Web-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å** –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- ‚úÖ **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** –æ –ø—Ä–æ–±–ª–µ–º–∞—Ö
- ‚úÖ **Graceful shutdown** –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ
- ‚úÖ **–ê–≤—Ç–æ–∑–∞–ø—É—Å–∫** –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ —Å–µ—Ä–≤–µ—Ä–∞
