#!/bin/bash

# –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã –≤ —Å—Ç—Ä–æ–∫–µ 48 server.js –∫–∞—Ç–∞–ª–æ–≥–∞
# –í—ã—è—Å–Ω—è–µ—Ç —á—Ç–æ –∏–º–µ–Ω–Ω–æ –≤—ã–∑—ã–≤–∞–µ—Ç MODULE_NOT_FOUND

echo "üîç –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê –ü–†–û–ë–õ–ï–ú–´ –í –°–¢–†–û–ö–ï 48..."
echo "===================================="

cd /var/www/catalog-interface

echo "üìä –≠–¢–ê–ü 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–∞ server.js..."
echo "==================================="

if [ -f "server.js" ]; then
    echo "‚úÖ server.js –Ω–∞–π–¥–µ–Ω"
    echo "üìã –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞: $(wc -l < server.js) —Å—Ç—Ä–æ–∫"
    echo "üìã –°—Ç—Ä–æ–∫–∞ 48:"
    sed -n '48p' server.js
    echo ""
    echo "üìã –°—Ç—Ä–æ–∫–∏ 45-50:"
    sed -n '45,50p' server.js
else
    echo "‚ùå server.js –Ω–µ –Ω–∞–π–¥–µ–Ω"
    exit 1
fi

echo ""
echo "üìä –≠–¢–ê–ü 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö require() –≤ server.js..."
echo "=============================================="

echo "üìã –í—Å–µ –∏–º–ø–æ—Ä—Ç—ã:"
grep -n "require(" server.js

echo ""
echo "üìä –≠–¢–ê–ü 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ package.json..."
echo "================================="

if [ -f "package.json" ]; then
    echo "‚úÖ package.json –Ω–∞–π–¥–µ–Ω"
    echo "üìã –°–æ–¥–µ—Ä–∂–∏–º–æ–µ package.json:"
    cat package.json
else
    echo "‚ùå package.json –Ω–µ –Ω–∞–π–¥–µ–Ω"
fi

echo ""
echo "üìä –≠–¢–ê–ü 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ node_modules..."
echo "================================="

if [ -d "node_modules" ]; then
    echo "‚úÖ node_modules –Ω–∞–π–¥–µ–Ω"
    echo "üìã –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–æ–¥—É–ª–µ–π: $(ls node_modules | wc -l)"
    echo "üìã –û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥—É–ª–∏:"
    ls node_modules | grep -E "^(express|cors|pg|path)$" || echo "–û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥—É–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"
else
    echo "‚ùå node_modules –Ω–µ –Ω–∞–π–¥–µ–Ω"
fi

echo ""
echo "üìä –≠–¢–ê–ü 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –º–æ–¥—É–ª–µ–π..."
echo "======================================"

for module in "express" "cors" "pg" "path"; do
    if [ -d "node_modules/$module" ]; then
        echo "‚úÖ $module –Ω–∞–π–¥–µ–Ω"
    else
        echo "‚ùå $module –Ω–µ –Ω–∞–π–¥–µ–Ω"
    fi
done

echo ""
echo "üìä –≠–¢–ê–ü 6: –ü—Ä–æ–≤–µ—Ä–∫–∞ config.js..."
echo "============================="

if [ -f "config.js" ]; then
    echo "‚úÖ config.js –Ω–∞–π–¥–µ–Ω"
    echo "üìã –°–æ–¥–µ—Ä–∂–∏–º–æ–µ config.js:"
    cat config.js
else
    echo "‚ùå config.js –Ω–µ –Ω–∞–π–¥–µ–Ω"
fi

echo ""
echo "üìä –≠–¢–ê–ü 7: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ server.js..."
echo "============================================="

echo "üìã –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞:"
node -c server.js 2>&1

echo ""
echo "üìä –≠–¢–ê–ü 8: –ü–æ–ø—ã—Ç–∫–∞ –∑–∞–ø—É—Å–∫–∞ server.js –≤—Ä—É—á–Ω—É—é..."
echo "==========================================="

echo "üìã –ó–∞–ø—É—Å–∫ server.js (5 —Å–µ–∫—É–Ω–¥):"
timeout 5 node server.js 2>&1 || echo "–ü—Ä–æ—Ü–µ—Å—Å –∑–∞–≤–µ—Ä—à–µ–Ω –ø–æ —Ç–∞–π–º–∞—É—Ç—É –∏–ª–∏ —Å –æ—à–∏–±–∫–æ–π"

echo ""
echo "üìä –≠–¢–ê–ü 9: –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏ Node.js..."
echo "=================================="

node --version

echo ""
echo "üìä –≠–¢–ê–ü 10: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞..."
echo "================================="

echo "üìã –ü—Ä–∞–≤–∞ –Ω–∞ —Ñ–∞–π–ª—ã:"
ls -la server.js package.json config.js 2>/dev/null || echo "–§–∞–π–ª—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"

echo ""
echo "üìä –≠–¢–ê–ü 11: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π..."
echo "================================="

echo "üìã –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥—É–ª–∏:"
for module in "express" "cors" "pg" "path"; do
    if [ -d "node_modules/$module" ]; then
        echo "‚úÖ $module –Ω–∞–π–¥–µ–Ω"
    else
        echo "‚ùå $module –Ω–µ –Ω–∞–π–¥–µ–Ω"
    fi
done

echo ""
echo "üìä –≠–¢–ê–ü 12: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–º–ø–æ—Ä—Ç–æ–≤ –≤ —Å—Ç—Ä–æ–∫–µ 48..."
echo "========================================="

echo "üìã –°—Ç—Ä–æ–∫–∞ 48:"
sed -n '48p' server.js

echo "üìã –ö–æ–Ω—Ç–µ–∫—Å—Ç —Å—Ç—Ä–æ–∫–∏ 48:"
sed -n '45,50p' server.js

echo "üìã –ü–æ–∏—Å–∫ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –∏–º–ø–æ—Ä—Ç–æ–≤:"
grep -n "require.*admin" server.js || echo "–ò–º–ø–æ—Ä—Ç—ã admin –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"
grep -n "require.*WinnerRatingsService" server.js || echo "–ò–º–ø–æ—Ä—Ç WinnerRatingsService –Ω–µ –Ω–∞–π–¥–µ–Ω"
grep -n "require.*admin-server" server.js || echo "–ò–º–ø–æ—Ä—Ç admin-server –Ω–µ –Ω–∞–π–¥–µ–Ω"

echo ""
echo "‚úÖ –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê –ó–ê–í–ï–†–®–ï–ù–ê!"
echo "========================="
echo "üí° –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤—ã—à–µ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º—ã"
echo "üí° –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –≤ —Å—Ç—Ä–æ–∫–µ 48, –≤–æ–∑–º–æ–∂–Ω–æ —Ç–∞–º –µ—Å—Ç—å –∏–º–ø–æ—Ä—Ç admin –º–æ–¥—É–ª–µ–π"
