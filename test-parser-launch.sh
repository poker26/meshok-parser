#!/bin/bash

# –¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–ø—É—Å–∫–∞ –ø–∞—Ä—Å–µ—Ä–∞
# –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –ø–∞—Ä—Å–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç

echo "üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞ –ø–∞—Ä—Å–µ—Ä–∞..."
echo "=================================="

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º—ã –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
if [ ! -f "wolmar-parser5.js" ]; then
    echo "‚ùå –û—à–∏–±–∫–∞: –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∏–∑ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ wolmar-parser"
    exit 1
fi

echo "üìä –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å PM2..."
pm2 status

echo ""
echo "üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–ø—É—â–µ–Ω–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –ø–∞—Ä—Å–µ—Ä–∞..."
ps aux | grep wolmar-parser5 | grep -v grep

echo ""
echo "üöÄ –¢–µ—Å—Ç–∏—Ä—É–µ–º –∑–∞–ø—É—Å–∫ –ø–∞—Ä—Å–µ—Ä–∞ —á–µ—Ä–µ–∑ PM2..."
echo "–ö–æ–º–∞–Ω–¥–∞: pm2 start wolmar-parser5.js --name 'test-parser' -- index 2135 1931"

# –ó–∞–ø—É—Å–∫–∞–µ–º –ø–∞—Ä—Å–µ—Ä —á–µ—Ä–µ–∑ PM2
pm2 start wolmar-parser5.js --name "test-parser" -- index 2135 1931

if [ $? -eq 0 ]; then
    echo "‚úÖ –ü–∞—Ä—Å–µ—Ä –∑–∞–ø—É—â–µ–Ω —á–µ—Ä–µ–∑ PM2"
    
    echo ""
    echo "üìä –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å PM2 –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞..."
    pm2 status
    
    echo ""
    echo "üìã –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–æ–≥–∏ –ø–∞—Ä—Å–µ—Ä–∞..."
    pm2 logs test-parser --lines 10 --nostream
    
    echo ""
    echo "‚è∞ –ñ–¥–µ–º 10 —Å–µ–∫—É–Ω–¥ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã..."
    sleep 10
    
    echo ""
    echo "üìä –§–∏–Ω–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å PM2..."
    pm2 status
    
    echo ""
    echo "üßπ –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π –ø–∞—Ä—Å–µ—Ä..."
    pm2 stop test-parser
    pm2 delete test-parser
    
    echo "‚úÖ –¢–µ—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω"
else
    echo "‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –ø–∞—Ä—Å–µ—Ä–∞ —á–µ—Ä–µ–∑ PM2"
    exit 1
fi

echo ""
echo "üìã –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:"
echo "  ‚Ä¢ PM2 –¥–æ—Å—Ç—É–ø–µ–Ω: ‚úÖ"
echo "  ‚Ä¢ –ü–∞—Ä—Å–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è: ‚úÖ"
echo "  ‚Ä¢ –õ–æ–≥–∏ —Ä–∞–±–æ—Ç–∞—é—Ç: ‚úÖ"
echo "  ‚Ä¢ –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç: ‚úÖ"
echo ""
echo "üéØ –ü–∞—Ä—Å–µ—Ä –≥–æ—Ç–æ–≤ –∫ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—é!"
