#!/bin/bash

# –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ PM2
# –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å PM2 –∏ –µ–≥–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

echo "üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ PM2..."
echo "===================="

echo "üìä –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å—Ç–∞–Ω–æ–≤–∫—É PM2..."
if command -v pm2 >/dev/null 2>&1; then
    echo "‚úÖ PM2 —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
    pm2 --version
else
    echo "‚ùå PM2 –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
    echo "üí° –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ PM2: npm install -g pm2"
    exit 1
fi

echo ""
echo "üìä –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å PM2..."
pm2 status

echo ""
echo "üìä –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–æ—Ü–µ—Å—Å—ã PM2..."
pm2 list

echo ""
echo "üìä –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–æ–≥–∏ PM2..."
pm2 logs --lines 5 --nostream

echo ""
echo "üß™ –¢–µ—Å—Ç–∏—Ä—É–µ–º –∑–∞–ø—É—Å–∫ –ø—Ä–æ—Å—Ç–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ —á–µ—Ä–µ–∑ PM2..."
echo "–ö–æ–º–∞–Ω–¥–∞: pm2 start 'echo test' --name 'test-process'"

# –¢–µ—Å—Ç–∏—Ä—É–µ–º –∑–∞–ø—É—Å–∫ –ø—Ä–æ—Å—Ç–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞
pm2 start 'echo test' --name 'test-process'

if [ $? -eq 0 ]; then
    echo "‚úÖ PM2 –∫–æ–º–∞–Ω–¥–∞ –≤—ã–ø–æ–ª–Ω–∏–ª–∞—Å—å —É—Å–ø–µ—à–Ω–æ"
    
    echo ""
    echo "üìä –°—Ç–∞—Ç—É—Å –ø–æ—Å–ª–µ —Ç–µ—Å—Ç–∞:"
    pm2 status
    
    echo ""
    echo "üßπ –û—á–∏—â–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å..."
    pm2 stop test-process
    pm2 delete test-process
    
    echo "‚úÖ PM2 —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ"
else
    echo "‚ùå –û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è PM2 –∫–æ–º–∞–Ω–¥—ã"
    echo "üí° –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é PM2"
fi

echo ""
echo "üìã –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:"
echo "================"
echo "1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ PM2 —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≥–ª–æ–±–∞–ª—å–Ω–æ: npm install -g pm2"
echo "2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞: sudo chown -R $USER:$USER ~/.pm2"
echo "3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ PM2: pm2 kill && pm2 resurrect"
echo "4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é: pm2 startup"
