#!/bin/bash

# –¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–µ—Ö–∞–Ω–∏–∑–º–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞—Ä—Å–µ—Ä–æ–≤
# –°–æ–∑–¥–∞–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∞–Ω–∞–ª–∏–∑ —Å–±–æ—è

echo "üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Ö–∞–Ω–∏–∑–º–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞—Ä—Å–µ—Ä–æ–≤..."
echo "=================================================="

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º—ã –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
if [ ! -f "server.js" ]; then
    echo "‚ùå –û—à–∏–±–∫–∞: –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∏–∑ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ wolmar-parser"
    exit 1
fi

# –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
echo "üìù –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã –ø—Ä–æ–≥—Ä–µ—Å—Å–∞..."

# –¢–µ—Å—Ç 1: –û—Å–Ω–æ–≤–Ω–æ–π –ø–∞—Ä—Å–µ—Ä
cat > test_parser_progress_2133.json << EOF
{
    "auctionNumber": "2133",
    "currentLot": 150,
    "progress": 75.5,
    "totalLots": 200,
    "lastUpdate": "$(date -u +%Y-%m-%dT%H:%M:%S.%3NZ)"
}
EOF

# –¢–µ—Å—Ç 2: –ü–∞—Ä—Å–µ—Ä –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞–≤–æ–∫
cat > test_mass_update_progress_968.json << EOF
{
    "auctionNumber": "968",
    "updateProgress": {
        "currentLot": 200,
        "progress": 80.0,
        "totalLots": 250
    },
    "lastUpdate": "$(date -u +%Y-%m-%dT%H:%M:%S.%3NZ)"
}
EOF

# –¢–µ—Å—Ç 3: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–æ–≥–Ω–æ–∑–æ–≤
cat > test_predictions_progress_2133.json << EOF
{
    "auctionNumber": "2133",
    "predictionsProgress": {
        "currentIndex": 100,
        "progress": 50.0,
        "totalLots": 200
    },
    "lastUpdate": "$(date -u +%Y-%m-%dT%H:%M:%S.%3NZ)"
}
EOF

echo "‚úÖ –¢–µ—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã —Å–æ–∑–¥–∞–Ω—ã"

# –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∞–ª–∏–∑ —Å–±–æ—è
echo ""
echo "üîç –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∞–ª–∏–∑ —Å–±–æ—è..."
node analyze-crash-recovery.js

if [ $? -eq 0 ]; then
    echo "‚úÖ –ê–Ω–∞–ª–∏–∑ —Å–±–æ—è –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ"
else
    echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∞–Ω–∞–ª–∏–∑–µ —Å–±–æ—è"
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ—Ç—á–µ—Ç
echo ""
echo "üìÑ –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ—Ç—á–µ—Ç –æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏..."
if [ -f "crash-recovery-report.json" ]; then
    echo "‚úÖ –û—Ç—á–µ—Ç —Å–æ–∑–¥–∞–Ω: crash-recovery-report.json"
    echo "üìä –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –æ—Ç—á–µ—Ç–∞:"
    cat crash-recovery-report.json | jq . 2>/dev/null || cat crash-recovery-report.json
else
    echo "‚ùå –û—Ç—á–µ—Ç –Ω–µ —Å–æ–∑–¥–∞–Ω"
fi

# –¢–µ—Å—Ç–∏—Ä—É–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
echo ""
echo "üöÄ –¢–µ—Å—Ç–∏—Ä—É–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ..."
echo "‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï: –≠—Ç–æ —Ç–æ–ª—å–∫–æ —Ç–µ—Å—Ç, –ø–∞—Ä—Å–µ—Ä—ã –ù–ï –±—É–¥—É—Ç –∑–∞–ø—É—â–µ–Ω—ã"
echo "–î–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ —Å—Ç—Ä–æ–∫—É –Ω–∏–∂–µ:"
echo "# node analyze-crash-recovery.js --auto-recovery"

# –û—á–∏—â–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã
echo ""
echo "üßπ –û—á–∏—â–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã..."
rm -f test_*.json
rm -f crash-recovery-report.json

echo "‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ"
echo ""
echo "üìã –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:"
echo "  ‚Ä¢ –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞: ‚úÖ"
echo "  ‚Ä¢ –ê–Ω–∞–ª–∏–∑ —Å–±–æ—è: ‚úÖ"
echo "  ‚Ä¢ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–∞: ‚úÖ"
echo "  ‚Ä¢ –û—á–∏—Å—Ç–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤: ‚úÖ"
echo ""
echo "üéØ –ú–µ—Ö–∞–Ω–∏–∑–º –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç!"
